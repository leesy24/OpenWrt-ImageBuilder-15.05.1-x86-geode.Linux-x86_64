#!/bin/sh
# (C) 2020 DASAN InfoTek,
#           leesy@DSI
##
. common

while : ; do

	readSystem
	readNetwork

	inputvar=""

	menuinput "Status Overview" \
		'"ReviewStatus"      "Review Status .... Enter!"
		"1SystemConfig"      ">> Host Name & Date time __________Configure <<"
		"2LanConfig"         ">> LAN Network ____________________Configure <<"
		"3FirstWiFiConfig"   ">> 1st Wireless Network ___________Configure <<"
		"4SecondWiFiConfig"  ">> 2nd Wireless Network ___________Configure <<"
		"5DualStationConfig" ">> Dual Station Roaming ___________Configure <<"
		"6SaveCommit"        "Commit All Configure Save!"
		"7SaveReboot"        "Save(commit) & ReBOOT....!"
		"8JustREBOOT"        "==============>ReBOOT....!"'

	case $inputvar in

	ReviewStatus)
		;;

	1SystemConfig)
		/etc/dwsb/system
		;;

	2LanConfig)
		/etc/dwsb/net_lan
		;;

	3FirstWiFiConfig)
		/etc/dwsb/net_wifi 0
		;;

	4SecondWiFiConfig)
		/etc/dwsb/net_wifi 1
		;;

	5DualStationConfig)
		/etc/dwsb/dual_sta_roaming
		;;

	6SaveCommit)
		textinput \
			 "Commit All Configures & Save Now?? [Yes/No]\n\n"$(
			)"Please Enter:\n"$(
			)" [YES]/[no] \n" \
			"NO"
		if [ "$inputvar" = "YES" ] ; then
			/etc/init.d/dwsbRoaming stop
			/etc/init.d/dwsbLCD stop
			clear
			echo ; echo "[$cHostname].... Commit All Configures Save Now!!"
			uci commit
			echo ; echo "[$cHostname].... Restart Network Subsystem ...!!"
			/etc/init.d/network restart
			### Load dual station roaming configurations from file
			[ -e /etc/dwsb/dual_sta_roaming.cfg ] && {
				cp /etc/dwsb/dual_sta_roaming.cfg /tmp/dual_sta_roaming.cfg
				. /tmp/dual_sta_roaming.cfg
			}
			USE_DUALSTATION_MODE=$_USE_DUALSTATION_MODE
			if [ "$USE_DUALSTATION_MODE" = "Y" ] ; then
				/etc/init.d/dwsbRoaming enable
				/etc/init.d/dwsbRoaming start
			else
				/etc/init.d/dwsbRoaming disable
			fi
			/etc/init.d/dwsbLCD start
			sleep 10
		fi
		;;

	7SaveReboot)
		textinput \
			 "Commit All Configures & ReBOOT Now?? [Yes/No]\n\n"$(
			)"Please Enter:\n"$(
			)" [YES]/[no]\n" \
			"NO"
		if [ "$inputvar" = "YES" ] ; then
			/etc/init.d/dwsbRoaming stop
			/etc/init.d/dwsbLCD stop
			clear
			echo ; echo "[$cHostname].... Commit All Configures Now!!"
			uci commit
			### Load dual station roaming configurations from file
			[ -e /etc/dwsb/dual_sta_roaming.cfg ] && {
				cp /etc/dwsb/dual_sta_roaming.cfg /tmp/dual_sta_roaming.cfg
				. /tmp/dual_sta_roaming.cfg
			}
			USE_DUALSTATION_MODE=$_USE_DUALSTATION_MODE
			if [ "$USE_DUALSTATION_MODE" = "Y" ] ; then
				/etc/init.d/dwsbRoaming enable
			else
				/etc/init.d/dwsbRoaming disable
			fi
			echo ; echo "[$cHostname].... System Reboot Now!!"
			reboot
			while : ; do
				sleep 1
				echo -n "."
			done
		fi
		;;

	8JustREBOOT)
		textinput \
			 "===============> ReBOOT Now?? [Yes/No]\n\n"$(
			)"Please Enter:\n"$(
			)" [YES]/[no]\n" \
			"NO"
		if [ "$inputvar" = "YES" ] ; then
		  clear
		  echo ; echo "[$cHostname].... System Reboot Now!!"
		  reboot -f
		  while : ; do
			sleep 1
			echo -n "."
		  done
		fi
		;;

	# *)
	#	rm $tempfile >/dev/null 2>/dev/null
	#	exit 0
	#	;;

	esac

done

sync

rm $tempfile >/dev/null 2>/dev/null
exit 0

